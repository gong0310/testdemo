(function(){var e={7194:function(e,t,s){"use strict";var i=s(6369),n=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("KeepAlive",[e.$route.meta.keepAlive?t("router-view"):e._e()],1),e.$route.meta.keepAlive?e._e():t("router-view")],1)},a=[],o={name:"App",components:{},data(){return{}},mounted(){function e(){WeixinJSBridge.call("hideOptionMenu")}"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",e,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",e),document.attachEvent("onWeixinJSBridgeReady",e)):e()},methods:{}},r=o,c=s(3736),l=(0,c.Z)(r,n,a,!1,null,null,null),u=l.exports,d=s(9451),h=s.n(d),f=s(2631),m=function(){var e=this,t=e._self._c;return t("div",{staticClass:"login"},[t("div",{staticClass:"login-container"},[t("div",{staticClass:"login-form"},[t("p",{staticClass:"login-form-title"},[e._v("手机验证码登录")]),t("div",{staticClass:"login-form-item"},[t("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.loginForm.account,expression:"loginForm.account",modifiers:{trim:!0}}],attrs:{type:"number",name:"account",placeholder:"请输入手机号"},domProps:{value:e.loginForm.account},on:{input:[function(t){t.target.composing||e.$set(e.loginForm,"account",t.target.value.trim())},function(t){return e.handleInput("account",t)}],blur:function(t){return e.$forceUpdate()}}}),t("p",{directives:[{name:"show",rawName:"v-show",value:e.loginRules.account.showIndex,expression:"loginRules.account.showIndex"}],staticClass:"login-form-item-error"},[e._v(" "+e._s(e.loginRules.account.tips[e.loginRules.account.showIndex])+" ")])]),t("div",{staticClass:"login-form-item"},[t("div",{staticClass:"login-form-code"},[t("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.loginForm.code,expression:"loginForm.code",modifiers:{trim:!0}}],attrs:{type:"number",name:"code",placeholder:"请输入验证码"},domProps:{value:e.loginForm.code},on:{input:[function(t){t.target.composing||e.$set(e.loginForm,"code",t.target.value.trim())},function(t){return e.handleInput("code",t)}],blur:function(t){return e.$forceUpdate()}}}),t("button",{class:e.codeInfo.disabled?"login-form-code-disabled":"",on:{click:e.handleSendCodeValidate}},[e._v(" "+e._s(e.codeInfo.tips)+" ")])]),t("p",{directives:[{name:"show",rawName:"v-show",value:e.loginRules.code.showIndex,expression:"loginRules.code.showIndex"}],staticClass:"login-form-item-error"},[e._v(" "+e._s(e.loginRules.code.tips[e.loginRules.code.showIndex])+" ")])]),t("button",{staticClass:"login-form-submit",on:{click:e.handleLogin}},[e._v("登录")])])])])},g=[],p=(s(2801),s(3029)),_=s(5743),v=s.n(_),I=s(4161),y=s(2229),w=s.n(y),C=s(6581),b=(s(6681),s(7658),s(9624));const L=(e,t)=>{switch(console.log("errorHandle",e,t),e){case 401:return t||"未授权";case 403:return t||"拒绝访问";case 404:return t||"请求的资源不存在";default:return t||"接口解析错误"}};let S=!1,T=[];const E=async()=>{let e;try{e=await M()}catch(t){return void E()}X.setItem({name:b.LA,value:e.token,expires:1e3*e.token_expire_unix}),X.setItem({name:b.z6,value:e.token_refresh_unix,expires:1e3*e.token_refresh_unix})},x=I.Z.create({baseURL:{NODE_ENV:"production",BASE_URL:"./"}.VUE_APP_BASE_API,timeout:3e5,headers:{}});x.interceptors.request.use((e=>{const t=X.getItem(b.LA);return t&&(e.headers["Authorization"]=t,e.headers["Nonce-Str"]=te()),e}),(e=>Promise.reject(e))),x.interceptors.response.use((e=>{if(200===e.status&&e.data){const t=e.data;return 101!==t.code||e.config.url.includes("/kfh5/user/token/refresh")||X.getItem(b.z6)||!X.getItem(b.LA)?0!==t.code?Promise.reject({...e,code:t.code,msg:t.errMsg}):Promise.resolve(t.data):(console.log("无refreshToken",e.config.url),S?new Promise((t=>{T.push((s=>{e.config.headers.Authorization=s,t(x(e.config))}))})):(S=!0,(0,I.Z)({url:"/auth/refresh-token",method:"post",headers:{Authorization:X.getItem(b.LA),["Nonce-Str"]:te()}}).then((t=>{const s=t.data;return 0==s.code?(e.config.headers.Authorization=s.data.accessToken,X.setItem({name:b.LA,value:s.data.token,expires:1e3*s.data.token_expire_unix}),X.setItem({name:b.z6,value:s.data.token_refresh_unix,expires:1e3*s.data.token_refresh_unix}),T.forEach((e=>e(s.data.accessToken))),console.log("refresh response=>",T,e.config.url),T=[],x(e.config)):(console.log("刷新登录态code不为0"),E(),Promise.reject({status:b.Eh,msg:"无效请求"}))})).catch((()=>(console.log("刷新登录态异常"),E(),Promise.reject({status:b.Eh,msg:"无效请求"})))).finally((()=>{S=!1}))))}return Promise.reject({...e,msg:`错误：status：${e.status} - data：${e.data}`})}),(e=>{const{response:t}=e;if(t){const e=L(t.status,t.data.message);return console.log("结果=>","666"),Promise.reject({...t,msg:`${t.status}：${e}`})}return console.log("网络异常 请稍后重试"),Promise.reject({status:b.L_,msg:"网络异常 请稍后重试"})}));var k=x;function M(e){return k({url:"/kfh5/user/login",method:"post",data:e})}function P(e){return k({url:"/kfh5/user/profile",method:"post",data:e})}function B(e){return k({url:"/kfh5/message/session/init",method:"post",data:e})}function A(e){return k({url:"/kfh5/message/session/quit",method:"post",data:e})}function R(e){return k({url:"/kfh5/message/session/heartbeat",method:"post",data:e})}function O(e){return k({url:"/kfh5/message/send",method:"post",data:e})}function N(e){return k({url:"/kfh5/message/pull",method:"post",data:e})}function U(e){return k({url:"/kfh5/message/leave",method:"post",data:e})}function Y(e){return k({url:"/kfh5/message/msqueue/query",method:"post",data:e})}function $(e){return k({url:"/kfh5/message/msqueue/hang-up",method:"post",data:e})}function Z(e){return k({url:"/kfh5/message/msqueue/evaluate",method:"post",data:e})}function H(e){return k({url:"/kfh5/message/msqueue/join",method:"post",data:e})}function D(e){return k({url:"/kfh5/message/banner/one",method:"post",data:e})}function F(e){return k({url:"/kfh5/message/issue/hot/list",method:"post",data:e})}function j(e){return k({url:"/kfh5/message/issue/relate/list",method:"post",data:e})}function q(e){return k({url:"/kfh5/message/order/riding/list",method:"post",data:e})}function z(e){return k({url:"/kfh5/message/filemanager/upload/apply",method:"post",data:e})}function V(e){return k({url:"/kfh5/message/filemanager/upload/success",method:"post",data:e})}const J=function(e){return/^(?:(?:\+|00)86)?1[3-9]\d{9}$/.test(e)};const Q=function(e){return w()(e)},W=function(e,t){return v().unix(e).format(t||"YYYY/MM/DD HH:mm:ss")};class K{constructor(){this.name="storage"}setItem(e){let t={name:"",value:"",expires:""},s={};if(Object.assign(s,t,e),s.expires)localStorage.setItem(s.name,JSON.stringify(s));else{let e=Object.prototype.toString.call(s.value);"[object Object]"!=e&&"[object Array]"!=e||(s.value=JSON.stringify(s.value)),localStorage.setItem(s.name,s.value)}}getItem(e){let t=localStorage.getItem(e);if(!t)return!1;try{t=JSON.parse(t)}catch(s){}if(t.expires){let s=(new Date).getTime();return s>t.expires?(localStorage.removeItem(e),!1):t.value}return t}removeItem(e){localStorage.removeItem(e)}clear(){localStorage.clear()}}const X=new K;function G(e){return/^(?:(?:\+|00)86)?1\d{10}$/.test(e)}const ee=function(e){return new Promise((t=>setTimeout((()=>{t()}),e)))},te=function(){return(0,p.Z)().split("-")[0]+(new Date).getTime()+se(10)},se=function(e){const t=Math.floor((Math.random()+Math.floor(9*Math.random()+1))*Math.pow(10,e-1));return t},ie=async(e,t)=>{let s;try{s=await z(e,t)}catch(i){throw new Error(i.msg)}return s},ne=async(e,t,s)=>(0,I.Z)({url:e,data:t,method:"put",headers:s}),ae=function({session_id:e,fileData:t}){return new Promise(((s,i)=>{let n=new FileReader;n.readAsBinaryString(t),n.addEventListener("loadend",(async()=>{const a=n.result;let o=C.md.md5.create().update(a).digest(),r=window.btoa(o.data);const c={"Content-MD5":r},l=new FormData;let u,d;l.append("file",t);try{u=await ie({session_id:e,file_type:b.Ry.image,filename:t.name,md5:c["Content-MD5"],contentType:t.type,size:t.size}),u.hit||await ne(u.upload_url,t,{"Content-MD5":c["Content-MD5"],"Content-Type":t.type}),d=await oe({session_id:e,file_id:u.file_id})}catch(h){return void i({message:h.message||"上传失败，请稍后重试"})}s({file_id:u.file_id,...d})}))}))},oe=async(e,t)=>{if(!e.session_id||!e.file_id)throw new Error("参数错误");let s;try{s=await V(e,t)}catch(i){throw new Error(i.msg)}return s},re=e=>{const t={};var s=/\?/g;if(s.test(e)){const s=e.substr(e.indexOf("?")+1),i=s.split("&");for(let e=0;e<i.length;e++){const s=i[e].split("=");t[s[0]]=s[1]}}return t},ce=e=>new Blob([e],{type:e.type}),le=({blob:e,filename:t,type:s})=>new File([e],t,{type:s});var ue={name:"Login",components:{},data(){return{loginForm:{account:"",code:""},loginRules:{account:{tips:["","请输入手机号码","手机号码格式错误"],showIndex:0},code:{tips:["","请输入验证码","验证码错误"],showIndex:0}},loginLoading:!1,codeInfo:{loading:!1,tips:"获取验证码",time:6,disabled:!1}}},mounted(){},methods:{handleInput(e,t){t.target.value?"account"!=e||G(t.target.value)?this.loginRules[e].showIndex=0:this.loginRules[e].showIndex=2:this.loginRules[e].showIndex=1},async handleSendCodeValidate(){this.loginForm.account?this.loginRules.account.showIndex||this.handleSendCode():this.loginRules.account.showIndex=1},async handleSendCode(){if(this.codeInfo.disabled)return;this.codeInfo.loading=!0,this.codeInfo.tips="发送中",this.codeInfo.loading=!1,this.codeInfo.disabled=!0,this.codeInfo.tips=`${this.codeInfo.time}s`,this.codeInfo.time--;let e=setInterval((()=>{if(this.codeInfo.time<1)return this.codeInfo.disabled=!1,this.codeInfo.loading=!1,this.codeInfo.time=6,this.codeInfo.tips="重新获取",clearInterval(e),void(e=null);this.codeInfo.tips=`${this.codeInfo.time}s`,this.codeInfo.time--}),1e3)},async handleLogin(){this.loginForm.account?this.loginForm.code?this.loginRules.account.showIndex||this.loginRules.code.showIndex||(this.$loading.show(),this.$loading.hide(),console.log("请求登录成功")):this.loginRules.code.showIndex=1:this.loginRules.account.showIndex=1},async initUserInfo(){}}},de=ue,he=(0,c.Z)(de,m,g,!1,null,"6307cb86",null),fe=he.exports,me=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"home",style:e.pageLoading?" opacity: 0;pointer-events: none;":"opacity: 1;pointer-events: all;"},[e.bannerInfo.image_url?t("div",{staticClass:"banner"},[t("van-swipe",{attrs:{autoplay:3e3,"show-indicators":!1,"indicator-color":"white"}},[t("van-swipe-item",[t("img",{attrs:{src:e.bannerInfo.image_url,alt:""}})])],1)],1):e._e(),t("div",{staticClass:"chat"},[t("div",{ref:"common_chat_main",staticClass:"chat-container",on:{touchstart:e.handleTouchPage,scroll:e.handleMessageScorll}},[t("van-pull-refresh",{attrs:{"animation-duration":"0",disabled:e.chatFinished,"loosing-text":"下拉加载更多历史消息","pulling-text":"下拉加载更多历史消息"},on:{refresh:e.handleLoadHistoryList},model:{value:e.chatRefreshing,callback:function(t){e.chatRefreshing=t},expression:"chatRefreshing"}},[t("van-list",{attrs:{finished:!0,"finished-text":"",direction:"up","immediate-check":!1,offset:0},on:{load:e.onLoad},model:{value:e.chatLoading,callback:function(t){e.chatLoading=t},expression:"chatLoading"}},e._l(e.chatList,(function(s,i){return t("div",{key:i,staticClass:"chat-messages-item",attrs:{id:s.id}},[s.role==e.CHAT_ROLE_TYPE_ENUM.marginTip?t("div",{staticClass:"chat-messages-item-margin_tips"},[e._v(" "+e._s(s.content)+" ")]):e._e(),s.role==e.CHAT_ROLE_TYPE_ENUM.hotIssues?t("div",{staticClass:"chat-messages-hot_issues"},[t("div",{staticClass:"chat-messages-hot_issues-header"},[t("span",{style:`background-image: url('${e.hotIssueInfo.icon_url}');`}),t("p",[e._v("热门问题")])]),t("ul",{style:{height:e.hotIssuesHeight},attrs:{id:"hot_issues-list"}},e._l(e.hotIssueInfo.issue_list,(function(s,i){return t("li",{key:s.selfId,on:{click:function(t){return e.handleClickIssues(s)}}},[e._v(" "+e._s(i+1)+"."),t("span",[e._v(e._s(s.content))])])})),0)]):e._e(),s.role==e.CHAT_ROLE_TYPE_ENUM.roundTip?t("div",{staticClass:"chat-messages-item-roundtip"},[t("span",[e._v(e._s(s.content))])]):e._e(),s.role==e.CHAT_ROLE_TYPE_ENUM.defaultTip?t("div",{staticClass:"chat-messages-item-tips"},[e._v(" "+e._s(s.content)+" ")]):e._e(),s.role==e.CHAT_ROLE_TYPE_ENUM.switchKfBtn?t("div",{staticClass:"chat-messages-item-switch_btn"},[t("van-icon",{attrs:{name:"warning"}}),e._v(" 问题未解决，"),t("span",{on:{click:e.handleSwitchKf}},[e._v("我要转人工客服")])],1):e._e(),s.role==e.CHAT_ROLE_TYPE_ENUM.hangUpCard?t("div",{staticClass:"chat-messages-item-handup"},[t("p",{staticClass:"chat-messages-item-handup-tip"},[e._v(" - 已为您接通人工客服 - ")]),t("div",{staticClass:"chat-messages-item-handup-box"},[t("p",{staticClass:"chat-messages-item-handup-title"},[e._v(" 人工客服"+e._s(s.kfname)+" ")]),t("p",{staticClass:"chat-messages-item-handup-type"},[e._v("在线客服")]),t("p",{staticClass:"chat-messages-item-handup-btn",on:{click:function(t){return e.handleChatClose(!1,s.session_id)}}},[e._v(" 挂断聊天 ")])])]):e._e(),s.role==e.CHAT_ROLE_TYPE_ENUM.evaluate?t("div",{staticClass:"chat-messages-item-evaluate"},[t("p",{staticClass:"chat-messages-item-evaluate-title"},[e._v(" 请您对本次服务做出评价 ")]),t("div",{staticClass:"chat-messages-item-evaluate-box"},[t("span",[e._v("服务满意度")]),t("van-rate",{attrs:{size:18,color:"#FADB14","void-icon":"star","void-color":"#F5F5F5",readonly:0!==s.content},on:{change:function(t){return e.handleChangeRate(t,s)}},model:{value:s.content,callback:function(t){e.$set(s,"content",t)},expression:"item.content"}})],1)]):e._e(),s.role==e.CHAT_ROLE_TYPE_ENUM.leaveMsg?t("div",{staticClass:"chat-messages-item-leave"},[t("p",{staticClass:"chat-messages-item-leave-tip"},[e._v(" 很抱歉，暂时无法为您提供服务，请留言我们会尽快与您取得联系！ ")]),t("div",{staticClass:"chat-messages-item-leave-box"},[t("p",{staticClass:"chat-messages-item-leave-box-title"},[e._v("请留言")]),t("div",{staticClass:"chat-messages-item-leave-box-form form1"},[t("span",[e._v("联系方式")]),t("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.leaveInfo.contact_info,expression:"leaveInfo.contact_info",modifiers:{trim:!0}}],attrs:{type:"number",placeholder:"请预留您的联系方式"},domProps:{value:e.leaveInfo.contact_info},on:{input:function(t){t.target.composing||e.$set(e.leaveInfo,"contact_info",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}})]),t("div",{staticClass:"chat-messages-item-leave-box-form form2"},[t("span",[e._v("问题描述")]),t("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:e.leaveInfo.issue_desc,expression:"leaveInfo.issue_desc",modifiers:{trim:!0}}],attrs:{placeholder:"请描述您的问题",maxlength:"200"},domProps:{value:e.leaveInfo.issue_desc},on:{input:function(t){t.target.composing||e.$set(e.leaveInfo,"issue_desc",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}})]),t("button",{staticClass:"chat-messages-item-leave-box-btn",on:{click:e.handldeSubmitLeave}},[e._v(" 提交 ")])])]):e._e(),s.role==e.CHAT_ROLE_TYPE_ENUM.leaveMsgBtn?t("div",{staticClass:"chat-messages-item-leavebtn"},[t("p",{staticClass:"chat-messages-item-leavebtn-tip"},[e._v(" "+e._s(s.content)+" ")]),t("p",{staticClass:"chat-messages-item-leavebtn-btn",on:{click:e.handleLeaveMessageShow}},[e._v(" 【我要留言】 ")])]):e._e(),s.role==e.CHAT_ROLE_TYPE_ENUM.relatedIssues?t("div",{staticClass:"chat-messages-item-related_issues"},[t("p",{staticClass:"chat-messages-item-related_issues-title"},[e._v(" 以下问题是你关心的吗？ ")]),t("ul",{staticClass:"chat-messages-item-related_issues-list"},e._l(s.content,(function(s,i){return t("li",{key:i,on:{click:function(t){return e.handleClickIssues(s)}}},[e._v(" "+e._s(s.content)+" ")])})),0)]):s.role==e.CHAT_ROLE_TYPE_ENUM.user?t("div",{staticClass:"chat-messages-item-me"},[t("div",{staticClass:"chat-messages-item-me-user"},[s.contentType==e.CHAT_CONTENT_TYPE_ENUM.text?t("div",{staticClass:"chat-messages-item-me-user-content"},[t("div",{staticClass:"chat-messages-item-me-user-content-box"},[s.sendLoading?t("van-icon",{staticClass:"resend-btn loading-btn",attrs:{name:"replay"}}):s.sendSuss?e._e():t("van-icon",{staticClass:"resend-btn",attrs:{name:"warning"},on:{click:function(t){return e.handleReSendMeaasge(s)}}}),t("p",{staticClass:"chat-messages-item-me-user-content-text",domProps:{innerHTML:e._s(s.content.text)}})],1)]):s.contentType==e.CHAT_CONTENT_TYPE_ENUM.image?t("div",{staticClass:"chat-messages-item-me-user-content"},[t("div",{staticClass:"chat-messages-item-me-user-content-box"},[s.sendLoading?t("van-icon",{staticClass:"resend-btn loading-btn",attrs:{name:"replay"}}):s.sendSuss?e._e():t("van-icon",{staticClass:"resend-btn",attrs:{name:"warning"},on:{click:function(t){return e.handleReSendMeaasge(s)}}}),t("img",{staticClass:"img",attrs:{src:s.content.image},on:{click:function(t){return e.handlePicShow(s.content.image)}}})],1)]):s.contentType==e.CHAT_CONTENT_TYPE_ENUM.ride?t("div",{staticClass:"chat-messages-item-me-user-content ride"},[t("div",{staticClass:"chat-messages-item-me-user-content-box"},[s.sendLoading?t("van-icon",{staticClass:"resend-btn loading-btn",attrs:{name:"replay"}}):s.sendSuss?e._e():t("van-icon",{staticClass:"resend-btn",attrs:{name:"warning"},on:{click:function(t){return e.handleReSendMeaasge(s)}}}),t("div",{staticClass:"chat-messages-item-me-user-ride"},[t("p",{staticClass:"chat-messages-item-me-user-ride-title"},[e._v(" 乘车时间："),t("span",{staticStyle:{"margin-left":"5px"}},[e._v(e._s(e.timestamp2String(s.content.ride_record.exit_station_time)))])]),t("p",{staticClass:"chat-messages-item-me-user-ride-title"},[e._v(" 订单编号："),t("span",{staticStyle:{"margin-left":"5px"}},[e._v(e._s(s.content.ride_record.order_no))])]),t("div",{staticClass:"chat-messages-item-me-user-ride-info"},[t("p",{staticClass:"chat-messages-item-me-user-ride-info-title"},[e._v(" "+e._s(s.content.ride_record.enter_station)+" — "+e._s(s.content.ride_record.exit_station)+" ")]),t("p",{staticClass:"chat-messages-item-me-user-ride-info-count"},[e._v(" -¥"+e._s(s.content.ride_record.pay_amount)+" ")])]),t("p",{staticClass:"chat-messages-item-me-user-ride-state"},[e._v(" "+e._s(e.BILL_TRADE_STATUS_OBJECT[s.content.ride_record.trade_state]?e.BILL_TRADE_STATUS_OBJECT[s.content.ride_record.trade_state].label:"")+" ")])])],1)]):e._e(),t("div",{staticClass:"chat-messages-item-me-user-avatar"},[t("img",{attrs:{src:e.userProfile.avatar_url,alt:""}})])])]):s.role==e.CHAT_ROLE_TYPE_ENUM.staff||s.role==e.CHAT_ROLE_TYPE_ENUM.robot?t("div",{staticClass:"chat-messages-item-you"},[t("div",{staticClass:"chat-messages-item-you-user"},[t("div",{staticClass:"chat-messages-item-you-user-avatar"},[t("img",{attrs:{src:s.kfAvatar,alt:""}})]),t("div",{staticClass:"chat-messages-item-you-user-info"},[t("p",{staticClass:"chat-messages-item-you-user-info-name"},[e._v(" "+e._s(s.kfname)+" ")]),s.contentType==e.CHAT_CONTENT_TYPE_ENUM.text?t("div",{staticClass:"chat-messages-item-you-user-content"},[t("p",{staticClass:"chat-messages-item-you-user-content-text",domProps:{innerHTML:e._s(s.content.text)}})]):s.contentType==e.CHAT_CONTENT_TYPE_ENUM.image?t("div",{staticClass:"chat-messages-item-you-user-content"},[t("img",{staticClass:"img",attrs:{src:s.content.image},on:{click:function(t){return e.handlePicShow(s.content.image)}}})]):s.contentType==e.CHAT_CONTENT_TYPE_ENUM.auto?t("div",{staticClass:"chat-messages-item-you-user-content"},[t("div",{staticClass:"chat-messages-item-you-user-content-auto"},[t("input",{staticStyle:{display:"none"},attrs:{type:"checkbox",id:"exp"}}),t("div",{staticClass:"chat-messages-item-you-user-content-auto-txt",attrs:{id:s.moreId}},[e._v(" "+e._s(s.content.text)+" ")]),s.showMoreBtn?t("label",{staticClass:"chat-messages-item-you-user-content-auto-btn",attrs:{for:"exp"},on:{click:function(t){return e.handleIssuesMoreShow(s)}}},[e._v(" 查看更多 ")]):e._e()])]):e._e()])])]):e._e()])})),0)],1)],1)]),t("div",{staticClass:"chat-footer"},[t("div",{staticClass:"chat-footer-tags"},[e.waitInfo.state==e.WAIT_STATUS_ENUM.success?t("div",{on:{click:function(t){return e.handleChatClose(!1,e.waitInfo.session_id)}}},[t("span"),e._v(" 挂断聊天 ")]):e._e(),t("div",{on:{click:e.handleRideRecordShow}},[e._v("乘车记录")]),t("div",{on:{click:e.handleRouterToLeaveMsg}},[e._v("留言列表")])]),t("div",{staticClass:"chat-footer-wrapper"},[t("div",{staticClass:"chat-footer-wrapper-box"},[t("div",{staticClass:"chat-footer-input",attrs:{maxlength:"500",contenteditable:"true"},on:{blur:e.handleInputBlur,focus:e.handleInputFocus,input:e.handleInput}}),e.chatInputFocus||e.chatInputContent?e._e():t("p",[e._v(" "+e._s(e.chatInfo.chat_window.prompt)+" ")])]),t("div",{staticClass:"chat-footer-send"},[t("div",{staticClass:"chat-footer-send-pic"},[t("input",{attrs:{type:"file",accept:"image/png, image/jpeg, image/gif, image/jpg",multiple:""},on:{change:e.handleChangeFile}}),t("img",{attrs:{src:s(4156),alt:""}})]),t("span",{staticClass:"chat-footer-send-txt",on:{click:function(t){return t.preventDefault(),e.handleSendText(t,null)}}})])])]),t("van-overlay",{attrs:{show:e.picVisible},on:{click:e.handlePicHide}},[e.picVisible?t("div",{staticClass:"view-pic",on:{click:e.handlePicHide}},[t("img",{attrs:{src:e.picSrc,alt:""}})]):e._e()]),t("van-overlay",{attrs:{show:e.leaveMessageVisible},on:{click:e.handleLeaveMessageHide}},[t("div",{staticClass:"leave",on:{click:function(e){e.stopPropagation()}}},[t("div",{staticClass:"leave-box"},[t("p",{staticClass:"leave-box-title"},[e._v("请留言")]),t("div",{staticClass:"leave-box-form form1"},[t("span",[e._v("联系方式")]),t("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.leaveInfo.contact_info,expression:"leaveInfo.contact_info",modifiers:{trim:!0}}],attrs:{type:"number",placeholder:"请预留您的联系方式"},domProps:{value:e.leaveInfo.contact_info},on:{input:function(t){t.target.composing||e.$set(e.leaveInfo,"contact_info",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}})]),t("div",{staticClass:"leave-box-form form2"},[t("span",[e._v("问题描述")]),t("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:e.leaveInfo.issue_desc,expression:"leaveInfo.issue_desc",modifiers:{trim:!0}}],attrs:{placeholder:"请描述您的问题",maxlength:"200"},domProps:{value:e.leaveInfo.issue_desc},on:{input:function(t){t.target.composing||e.$set(e.leaveInfo,"issue_desc",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}})]),t("button",{staticClass:"leave-box-btn",on:{click:function(t){return t.stopPropagation(),e.handldeSubmitLeave.apply(null,arguments)}}},[e._v(" 提交 ")])])])]),t("van-overlay",{attrs:{show:e.leaveMessageSuccVisible},on:{click:e.handleLeaveMessageSuccHide}},[t("div",{staticClass:"leave-succ"},[t("div",{staticClass:"leave-succ-box"},[t("img",{attrs:{src:s(3822),alt:""}}),t("p",{staticClass:"leave-succ-box-title"},[e._v("提交留言成功")]),t("p",{staticClass:"leave-succ-box-tip"},[e._v(" 我们会尽快与您取得联系，请耐心等候！ ")])])])]),t("van-popup",{attrs:{closeable:"",position:"bottom"},model:{value:e.rideRecordVisible,callback:function(t){e.rideRecordVisible=t},expression:"rideRecordVisible"}},[t("div",{staticClass:"ride-record"},[t("p",{staticClass:"ride-record-title"},[e._v("乘车记录")]),t("div",{staticClass:"ride-record-select"},[t("div",{on:{click:e.handlePayBusinessShow}},[e._v(" "+e._s(e.RIDE_PAY_BUSINESS_OBJECT[e.payBusiness].label)+" "),t("van-icon",{attrs:{name:"arrow-down"}})],1)]),t("van-tabs",{directives:[{name:"show",rawName:"v-show",value:e.payBusiness==e.RIDE_PAY_BUSINESS_ENUM.metroApp,expression:"payBusiness == RIDE_PAY_BUSINESS_ENUM.metroApp"}],attrs:{swipeable:"",animated:"","swipe-threshold":"3"},on:{change:e.handleRideSlideChange},model:{value:e.rideTabList.tabIndex,callback:function(t){e.$set(e.rideTabList,"tabIndex",t)},expression:"rideTabList.tabIndex"}},e._l(e.rideTabList.tabList,(function(i,n){return t("van-tab",{key:n,staticClass:"ride-record-box",attrs:{title:i.label}},[t("van-pull-refresh",{on:{refresh:function(t){return e.rideOnRefresh(i)}},model:{value:i.refreshing,callback:function(t){e.$set(i,"refreshing",t)},expression:"tabItem.refreshing"}},[t("van-list",{staticClass:"ride-record-list",attrs:{finished:i.finished,"finished-text":"没有更多了~","immediate-check":!0,offset:50},on:{load:function(t){return e.initRideList({page:i.page,size:i.size,pay_channel:i.value})}},model:{value:i.loading,callback:function(t){e.$set(i,"loading",t)},expression:"tabItem.loading"}},[i.list&&i.list.length?t("div",e._l(i.list,(function(s,i){return t("div",{key:i,staticClass:"ride-record-item"},[t("div",{staticClass:"ride-record-info"},[t("p",{staticClass:"ride-record-info-title"},[e._v(" "+e._s(s.enter_station)+" — "+e._s(s.exit_station)+" ")]),t("p",{staticClass:"ride-record-info-date"},[e._v(" 出站时间： "+e._s(e.timestamp2String(s.exit_station_time,"YYYY-MM-DD HH:mm:ss"))+" ")]),t("p",{staticClass:"ride-record-info-date"},[e._v(" 订单编号： "+e._s(s.order_no)+" ")])]),t("div",{staticClass:"ride-record-opt"},[t("p",{staticClass:"ride-record-opt-count"},[e._v(" "+e._s(e.BILL_TRADE_STATUS_OBJECT[s.trade_state]?e.BILL_TRADE_STATUS_OBJECT[s.trade_state].label:"")+" ")]),t("p",{staticClass:"ride-record-opt-count"},[e._v(" -¥"+e._s(s.pay_amount)+" ")]),t("button",{staticClass:"ride-record-opt-send",on:{click:function(t){return e.handleSendRide(s)}}},[e._v(" 发送 ")])])])})),0):i.list&&!i.list.length?t("div",{staticClass:"ride-record-empty"},[t("img",{attrs:{src:s(8773),alt:""}}),t("p",[e._v("暂无乘车记录")])]):e._e()])],1)],1)})),1),e.payBusiness!=e.RIDE_PAY_BUSINESS_ENUM.metroApp?t("div",{staticClass:"ride-record-box"},[t("van-pull-refresh",{on:{refresh:function(t){return e.rideOnRefresh(e.payBusinessOthersList)}},model:{value:e.payBusinessOthersList.refreshing,callback:function(t){e.$set(e.payBusinessOthersList,"refreshing",t)},expression:"payBusinessOthersList.refreshing"}},[t("van-list",{staticClass:"ride-record-list",attrs:{finished:e.payBusinessOthersList.finished,"finished-text":"没有更多了~","immediate-check":!0,offset:50},on:{load:function(t){return e.initRideList({page:e.payBusinessOthersList.page,size:e.payBusinessOthersList.size,pay_channel:""})}},model:{value:e.payBusinessOthersList.loading,callback:function(t){e.$set(e.payBusinessOthersList,"loading",t)},expression:"payBusinessOthersList.loading"}},[e.payBusinessOthersList.list&&e.payBusinessOthersList.list.length?t("div",e._l(e.payBusinessOthersList.list,(function(s,i){return t("div",{key:i,staticClass:"ride-record-item"},[t("div",{staticClass:"ride-record-info"},[t("p",{staticClass:"ride-record-info-title"},[e._v(" "+e._s(s.enter_station)+" — "+e._s(s.exit_station)+" ")]),t("p",{staticClass:"ride-record-info-date"},[e._v(" 出站时间： "+e._s(e.timestamp2String(s.exit_station_time,"YYYY-MM-DD HH:mm:ss"))+" ")]),t("p",{staticClass:"ride-record-info-date"},[e._v(" 订单编号： "+e._s(s.order_no)+" ")])]),t("div",{staticClass:"ride-record-opt"},[t("p",{staticClass:"ride-record-opt-count"},[e._v(" "+e._s(e.BILL_TRADE_STATUS_OBJECT[s.trade_state]?e.BILL_TRADE_STATUS_OBJECT[s.trade_state].label:"")+" ")]),t("p",{staticClass:"ride-record-opt-count"},[e._v(" -¥"+e._s(s.pay_amount)+" ")]),t("button",{staticClass:"ride-record-opt-send",on:{click:function(t){return e.handleSendRide(s)}}},[e._v(" 发送 ")])])])})),0):e.payBusinessOthersList.list&&!e.payBusinessOthersList.list.length?t("div",{staticClass:"ride-record-empty"},[t("img",{attrs:{src:s(8773),alt:""}}),t("p",[e._v("暂无乘车记录")])]):e._e()])],1)],1):e._e()],1)]),t("van-popup",{attrs:{position:"bottom"},model:{value:e.payBusinessVisible,callback:function(t){e.payBusinessVisible=t},expression:"payBusinessVisible"}},[t("div",{staticClass:"ride-record"},[t("van-picker",{ref:"myPicker",attrs:{title:"","show-toolbar":"",columns:e.RIDE_PAY_BUSINESS_LIST},on:{confirm:e.handlePayBusinessConfirm,cancel:e.handlePayBusinessCancel},scopedSlots:e._u([{key:"option",fn:function(s){return[t("div",[e._v(e._s(s.label))])]}}])})],1)])],1)])},ge=[],pe=(s(541),s(6229),s(7330),s(2062),s(5940)),_e=s.n(pe),ve={name:"HomeChat",data(){return{RIDE_PAY_BUSINESS_ENUM:b.ru,RIDE_PAY_BUSINESS_LIST:b.K0,RIDE_PAY_BUSINESS_OBJECT:b.Ws,CHAT_ROLE_TYPE_ENUM:b.Sc,RIDE_PAY_TYPE_LIST:b.JK,CHAT_CONTENT_TYPE_ENUM:b.vx,WAIT_STATUS_ENUM:b.yP,BILL_TRADE_STATUS_OBJECT:b.p6,timestamp2String:W,pageLoading:!0,chatInputContent:"",chatInputFocus:!1,firstMsgId:"",chatList:[],channelId:"",chatLoading:!1,chatFinished:!1,chatRefreshing:!1,picVisible:!1,picSrc:"",leaveMessageVisible:!1,leaveMessageSuccVisible:!1,leaveInfo:{contact_info:"",issue_desc:""},rideRecordVisible:!1,rideTabList:{tabIndex:0,tabList:[{loading:!1,finished:!1,refreshing:!1,label:b.gj[b.eC.zfb].label,value:b.eC.zfb,list:null,page:1,size:b.NR},{loading:!1,finished:!1,refreshing:!1,label:b.gj[b.eC.wx].label,value:b.eC.wx,list:null,page:1,size:b.NR},{loading:!1,finished:!1,refreshing:!1,label:b.gj[b.eC.union].label,value:b.eC.union,list:null,page:1,size:b.NR},{loading:!1,finished:!1,refreshing:!1,label:b.gj[b.eC.digital].label,value:b.eC.digital,list:null,page:1,size:b.NR}]},payBusinessVisible:!1,payBusiness:b.ru.metroApp,payBusinessOthersList:{loading:!1,finished:!1,refreshing:!1,list:null,page:1,size:b.NR},userProfile:{user_id:"",nickname:"",avatar_url:""},chatInfo:{session_id:"",chat_window:{name:b.i2,notes:"",welcome_message:"",prompt:b.iu,robot:{nickname:"",avatar_url:""}}},bannerInfo:{image_url:""},hotIssueInfo:{icon_url:"",issue_list:[]},hotIssuesHeight:"",relateIssueLoading:!1,waitInfo:{},waitList:[],kfReply:{timer:null,time:480},messageQuitTimer:null,messageQuitTime:0,messageQuitTipEnd:!1}},created(){{let e=navigator.userAgent;e.indexOf("iPhone")>-1&&_e().enable()}},watch:{$route(e){console.log("=======",e.path),"/leavemsg-list"==e.path&&(this.pageLoading=!0),"/"==e.path&&(document.title=this.chatInfo.chat_window.name,this.$nextTick((()=>{this.goEnd((()=>{this.pageLoading=!1}))})))}},computed:{disabledLeaveSubmit(){return!J(this.leaveInfo.contact_info)||!this.leaveInfo.issue_desc}},beforeDestroy(){_e().disable()},async mounted(){let e;if(window.localStorage.setItem("kf_a_tk","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NjI2ODQ4MjUsImlhdCI6MTcwMjIwNDgyNSwidXNlcl9pZCI6IjY1NTc1MjliNDY3OWY0Y2ViM2FjZjgyOCJ9.8kkbC69Z9Wj39PYabzhC5P-Yu26h46uEAfvBXK6Xzfk"),console.log("==================mounted page init=================="),/metro/i.test(navigator.userAgent)||/metro mPaaSClient/i.test(navigator.userAgent))console.log("ios",/metro/i.test(navigator.userAgent)),console.log("安卓",/metro mPaaSClient/i.test(navigator.userAgent)),console.log("大都会MetroApp"),window.AlipayJSBridge&&window.AlipayJSBridge.call("getUserId",(function(t){console.log("大都会APP UID",t),e=t.uid}));else{const t=re("https://www.baidu.com/?uid=mock&fid=2&channel=c8f3d527-18ee-436a-9cfa-119dda7ffc3d");if(console.log("小程序 url参数",t),!t.uid)return console.error("未解析出uid"),void this.$router.replace("/error");e=t.uid}this.pageLoading=!1},methods:{async handlePayBusinessShow(){this.payBusinessVisible=!0,await this.$nextTick();const e=b.K0.findIndex((e=>e.value==this.payBusiness));this.$refs.myPicker.setColumnIndex(0,e)},async handlePayBusinessConfirm(e){if(this.payBusiness!=e.value){if(this.payBusinessOthersList={loading:!1,finished:!1,refreshing:!1,list:null,page:1,size:b.NR},this.payBusiness!=b.ru.metroApp&&e.value!=b.ru.metroApp){let e=this.payBusinessOthersList;e.page=1;try{await this.initRideList({page:e.page,size:e.size,pay_channel:"",refresh:!0})}catch(t){return console.log("结果=>","111"),t.message!=b.Eh&&this.$toast({message:t.msg}),void(this.payBusinessOthersList.finished=!0)}this.payBusinessOthersList.finished=!1}this.payBusiness=e.value,this.handlePayBusinessCancel()}},handlePayBusinessCancel(){this.payBusinessVisible=!1},handleRouterToLeaveMsg(){this.$router.push({path:"/leavemsg-list"})},async init(){console.log("init invoke");const e=re("https://www.baidu.com/?uid=mock&fid=2&channel=c8f3d527-18ee-436a-9cfa-119dda7ffc3d");if(!e.channel)throw new Error("参数错误");this.channelId=e.channel;try{if(await this.initChatInfo(),await this.initUserProfile(),await this.initBanner(),[b.yP.fail].includes(this.chatInfo.state))return void console.warn("init fail",this.chatInfo.state);let e=await this.getMessage({mode:b.XI.prev,start_message_id:"",size:300});e=this.filterMessage(e),console.log("init 历史记录",e),e.length||(this.chatFinished=!0),this.chatList.unshift(...e),this.addChatTime(this.chatList),this.goEnd(),this.getMessageRegularTime()}catch(t){throw new Error(t.message)}},async initLogin(e){let t;console.log("initLogin invoke");try{t=await M(e)}catch(s){throw s.status!=b.Eh&&s.status!=b.L_?new Error(s.msg):new Error(s.status)}console.log("initLogin success resp=",t),X.setItem({name:b.LA,value:t.token,expires:1e3*t.token_expire_unix}),X.setItem({name:b.z6,value:t.token_refresh_unix,expires:1e3*t.token_refresh_unix})},async initUserProfile(){let e;console.log("initUserProfile invoke");try{e=await P()}catch(t){throw t.status!=b.Eh&&t.status!=b.L_?new Error(t.msg):new Error(t.status)}console.log("initUserProfile success resp=",e),this.userProfile=e},async initChatInfo(){let e;console.log("initChatInfo invoke",this.chatInfo.state);try{e=await this.initMessageInfo()}catch(t){if(t.message!=b.Eh)throw new Error(t.message);return}switch(this.chatInfo.state){case b.yP.init:this.chatList.push({id:te(),createUnix:parseInt((new Date).getTime()/1e3),sendSuss:!0,sendLoading:!1,showMoreBtn:!1,moreId:te(),customId:te(),role:b.Sc.robot,contentType:b.vx.auto,kfname:this.chatInfo.chat_window.robot.nickname,kfAvatar:this.chatInfo.chat_window.robot.avatar_url,content:{text:this.chatInfo.chat_window.welcome_message}});break;case b.yP.inqueue:let s=!1;try{const e=await this.getQueueStatus();if(console.log("initChatInfo getQueueStatus resp=",e),e.state==b.yP.success||0==e.in_queue_count)this.chatList.push({role:b.Sc.hangUpCard,content:"",customId:te(),kfId:e.staff_info.user_id,kfname:e.staff_info.nickname,session_id:e.session_id}),this.chatList.push({role:b.Sc.staff,contentType:b.vx.text,content:{text:`您好，客服${e.staff_info.nickname}为您服务，请问您有什么需要咨询的问题吗？`},customId:te(),sendSuss:!0,sendLoading:!1,showMoreBtn:!1,moreId:te(),kfId:e.staff_info.user_id,kfname:e.staff_info.nickname,kfAvatar:e.staff_info.avatar_url}),this.chatInfo.session_id=e.session_id,s=!0,this.watchChatActive();else if(e.state==b.yP.inqueue){if(this.waitInfo.in_queue_count===e.in_queue_count)return;this.chatList.push({role:b.Sc.roundTip,customId:te(),content:`在当前排队${e.in_queue_count}人，请稍后…`})}else e.state==b.yP.fail&&(this.chatList.push({role:b.Sc.leaveMsgBtn,customId:te(),content:"很抱歉，暂时无法为您提供服务，请留言我们会尽快与您取得联系！"}),s=!0);this.goEnd(null,100),this.waitInfo=e}catch(t){return void(t.message==b.L_?(this.chatList.push({role:b.Sc.defaultTip,customId:te(),content:"- 网络异常 请稍后重试 -"}),this.goEnd(null,100)):t.message!=b.Eh&&this.$toast({message:t.message}))}if(s)return;this.waitSwtichStaff(!0);break;case b.yP.success:this.chatList.push({role:b.Sc.hangUpCard,content:"",customId:te(),kfId:this.chatInfo.staff_info.user_id,kfname:this.chatInfo.staff_info.nickname,session_id:e.session_id}),this.chatList.push({role:b.Sc.staff,contentType:b.vx.text,content:{text:`您好，客服${this.chatInfo.staff_info.nickname}为您服务，请问您有什么需要咨询的问题吗？`},customId:te(),sendSuss:!0,sendLoading:!1,showMoreBtn:!1,moreId:te(),kfId:this.chatInfo.staff_info.user_id,kfname:this.chatInfo.staff_info.nickname,kfAvatar:this.chatInfo.staff_info.avatar_url}),this.waitInfo.state=b.yP.success,this.waitInfo.session_id=e.session_id,this.chatInfo.session_id=e.session_id,this.watchChatActive();break;case b.yP.transfer:this.chatList.push({role:b.Sc.roundTip,customId:te(),content:"客服转接中，请稍后…"}),this.goEnd(null,100),this.switchStaff();break;case b.yP.fail:this.chatList.push({sendSuss:!0,sendLoading:!1,customId:te(),role:b.Sc.leaveMsg}),this.chatFinished=!0;break;case b.yP.evaluate:this.chatList.push({role:b.Sc.defaultTip,customId:te(),content:"- 本次服务已完成，请为本次服务做出评价! -"}),this.chatList.push({role:b.Sc.evaluate,customId:te(),content:0,session_id:this.chatInfo.session_id});break;default:break}},async initMessageInfo(){console.log("initMessageInfo invoke");const e={channel:this.channelId};let t;try{t=await B(e)}catch(s){throw s.status!=b.Eh&&s.status!=b.L_?new Error(s.msg):new Error(s.status)}return console.log("initMessageInfo success resp=",t),t.chat_window.name=t.chat_window.name||b.i2,t.chat_window.prompt=t.chat_window.prompt||b.iu,this.chatInfo=t,document.title=this.chatInfo.chat_window.name,t},async initBanner(){console.log("initBanner invoke");const e={session_id:this.chatInfo.session_id};let t;try{t=await D(e)}catch(s){throw s.status!=b.Eh&&s.status!=b.L_?new Error(s.msg):new Error(s.status)}console.log("initBanner success resp=",t),this.bannerInfo=t,this.bannerInfo.image_url||(document.getElementsByClassName("home")[0].style["padding-top"]=0)},async initHotIssueList(){console.log("initHotIssueList invoke");const e={session_id:this.chatInfo.session_id};let t;try{t=await F(e)}catch(s){throw s.status!=b.Eh&&s.status!=b.L_?new Error(s.msg):new Error(s.status)}t.issue_list=t.issue_list||[],t.issue_list=t.issue_list.map((e=>({...e,selfId:e.id}))),console.log("initHotIssueList success resp=",t),console.log("-------------------",t.issue_list.slice(0,10)),t.issue_list&&t.issue_list.length&&(this.chatList.unshift({role:b.Sc.hotIssues,content:t}),t.issue_list.length>10?(this.hotIssueInfo={icon_url:t.icon_url,issue_list:t.issue_list.slice(0,10)},await this.$nextTick(),this.hotIssuesHeight=document.querySelector("#hot_issues-list").getBoundingClientRect().height+"px",this.hotIssueInfo.issue_list=t.issue_list):this.hotIssueInfo=t)},async initRideList(e){console.log("initRideList invoke",e);const t={session_id:this.chatInfo.session_id,page:e.page,size:e.size,filter:{pay_business:this.payBusiness,pay_channel:e.pay_channel}};let s;console.log("initRideList req=",t);try{s=await q(t)}catch(i){if(this.payBusiness==b.ru.metroApp){const t=this.rideTabList.tabList.find((t=>t.value==e.pay_channel));t.finished=!0,t.loading=!1}else this.payBusinessOthersList.finished=!0,this.payBusinessOthersList.loading=!0;throw i.status!=b.Eh&&i.status!=b.L_?new Error(i.msg):new Error(i.status)}if(console.log("initRideList success resp=",s),s.riding_list=s.riding_list||[],s.riding_list=s.riding_list.map((e=>({...e,selfId:e.id}))),this.payBusiness==b.ru.metroApp){const t=this.rideTabList.tabList.find((t=>t.value==e.pay_channel));if(t.list=t.list||[],!s.riding_list.length)return t.finished=!0,void(t.loading=!1);e.refresh?t.list=s.riding_list||[]:t.list.push(...s.riding_list||[]),t.loading=!1,t.page++}else{if(this.payBusinessOthersList.list=this.payBusinessOthersList.list||[],!s.riding_list.length)return this.payBusinessOthersList.finished=!0,void(this.payBusinessOthersList.loading=!1);e.refresh?this.payBusinessOthersList.list=s.riding_list||[]:this.payBusinessOthersList.list.push(...s.riding_list||[]),this.payBusinessOthersList.loading=!1,this.payBusinessOthersList.page++}},initMoreBtn(){console.log("initMoreBtn invoke"),this.$nextTick((()=>{this.chatList=this.chatList.map((e=>{if(e.contentType==b.vx.auto){const t=document.getElementById(e.moreId);t&&t.scrollHeight>t.clientHeight+10?(console.log("initMoreBtn show",e),e.showMoreBtn=!0):e.showMoreBtn=!1}return e}))}))},watchChatActive(){console.log("watchChatActive invoke"),clearInterval(this.messageQuitTimer),this.messageQuitTimer=null,this.messageQuitTime=0,this.messageQuitTipEnd=!1,this.messageQuitTimer=setInterval((()=>{this.messageQuitTime+=1,!this.messageQuitTipEnd&&this.messageQuitTime>=180&&(console.log("180秒不发消息，超时提醒"),this.chatList.push({role:b.Sc.defaultTip,customId:te(),content:"会话回复已超时，请及时回复哦，我们将全力协助您解决"}),this.goEnd(null,100),this.messageQuitTipEnd=!0),this.messageQuitTime>=220&&(console.log("220秒不发消息，退出会话"),clearInterval(this.messageQuitTimer),this.messageQuitTimer=null,this.chatList.push({role:b.Sc.defaultTip,customId:te(),content:"会话回复超时，会话挂断，本次服务已完成，请为本次服务做出评价！"}),this.goEnd(null,100),this.handleChatClose(!0,this.waitInfo.session_id))}),1e3)},async waitSwtichStaff(e=!1){console.log("waitSwtichStaff invoke",e);let t=setInterval((async()=>{try{const s=await this.getQueueStatus();if(console.log("waitSwtichStaff getQueueStatus resp=",s),s.state==b.yP.success||0==s.in_queue_count)clearInterval(t),t=null,!0===e?this.chatList.push({role:b.Sc.defaultTip,customId:te(),content:"- 客服接入成功，很高兴为您服务！-"}):this.chatList.push({role:b.Sc.hangUpCard,content:"",customId:te(),kfId:s.staff_info.user_id,kfname:s.staff_info.nickname,session_id:s.session_id}),this.chatList.push({role:b.Sc.staff,contentType:b.vx.text,content:{text:`您好，客服${s.staff_info.nickname}为您服务，请问您有什么需要咨询的问题吗？`},customId:te(),sendSuss:!0,sendLoading:!1,showMoreBtn:!1,moreId:te(),kfId:s.staff_info.user_id,kfname:s.staff_info.nickname,kfAvatar:s.staff_info.avatar_url}),this.watchChatActive(),this.chatInfo.session_id=s.session_id;else if(s.state==b.yP.inqueue){if(this.waitInfo.in_queue_count===s.in_queue_count)return;this.chatList.push({role:b.Sc.roundTip,customId:te(),content:`在当前排队${s.in_queue_count}人，请稍后…`})}else s.state==b.yP.fail&&(clearInterval(t),t=null,this.chatList.push({role:b.Sc.leaveMsgBtn,customId:te(),content:"很抱歉，暂时无法为您提供服务，请留言我们会尽快与您取得联系！"}));this.goEnd(null,100),this.waitInfo=s}catch(s){return s.message==b.L_?(this.chatList.push({role:b.Sc.defaultTip,customId:te(),content:"- 网络异常 请稍后重试 -"}),this.goEnd(null,100)):s.message!=b.Eh&&this.$toast({message:s.message}),clearInterval(t),void(t=null)}}),1e3)},filterMessage(e){return e.map((e=>{const t={selfId:e.selfId,client_message_id:e.client_message_id,message_id:e.message_id,role:"",contentType:e.message_type,content:e.content,createUnix:e.create_unix,sendSuss:!0,sendLoading:!1,showMoreBtn:!1,id:te(),moreId:te(),customId:te()};return e.belong_to==b.bj.user?t.role=b.Sc.user:e.belong_to==b.bj.staff&&e.staff_info.user_id?(t.role=b.Sc.staff,t.kfId=e.staff_info.user_id,t.kfname=e.staff_info.nickname,t.kfAvatar=e.staff_info.avatar_url):(t.role=b.Sc.robot,t.contentType=b.vx.auto,t.kfname=this.chatInfo.chat_window.robot.nickname,t.kfAvatar=this.chatInfo.chat_window.robot.avatar_url),t}))},async getRelateIssueList(e){const t={session_id:this.chatInfo.session_id,message:e};let s;try{s=await j(t)}catch(i){return this.$toast({message:i.msg}),[]}finally{this.relateIssueLoading=!1}s.issue_list=s.issue_list||[],s.issue_list=s.issue_list.map((e=>({...e,selfId:e.id}))),console.log("==========getRelateIssueList",s),s.issue_list.length&&(this.chatList.push({customId:te(),role:b.Sc.relatedIssues,content:s.issue_list}),this.goEnd())},async getMessageRegularTime(){if(clearInterval(this.kfReply.timer),this.kfReply.timer=null,this.kfReply.time=480,this.kfReply.timer=setInterval((async()=>{if(this.kfReply.time--,this.kfReply.time<=0)return console.log("======：客服回复超出时长超时，转接其他客服---\x3e留言大弹窗"),this.chatList.push({role:b.Sc.defaultTip,customId:te(),content:"很抱歉，目前无法准确定位您的问题，我们正在为您转接其他客服"}),this.chatList.push({role:b.Sc.roundTip,customId:te(),content:"客服转接中，我们正在为您转接其他客服，请稍后…"}),this.goEnd(null,100),clearInterval(this.kfReply.timer),this.kfReply.timer=null,void this.switchStaff()}),1e3),this.kfReply.time<=0)return;const e=Q(this.chatList).reverse().find((e=>e.selfId));let t=await this.getMessage({mode:b.XI.next,start_message_id:e?e.message_id:""});if(t=this.filterMessage(t),this.kfReply.time<=0)return;console.log("=======getMessageRegularTime",t);const s=[];t.forEach((e=>{let t=this.chatList.find((t=>t.client_message_id==e.client_message_id));console.warn("结果=========================>",t),t?t=Object.assign(t,e):s.push(e)})),this.chatList.push(...s),this.addChatTime(this.chatList),this.initMoreBtn(),t.length&&this.goEnd(),this.getMessageRegularTime()},async handleReSendMeaasge(e){console.log("=======handleReSendMeaasge",e);const t=this.chatList.findIndex((t=>t.client_message_id===e.client_message_id)),s=this.chatList.splice(t,1);if(this.chatList.push(...s),e.sendLoading=!0,e.contentType==b.vx.text){const t={message:e.content,type:b.vx.text,client_message_id:e.client_message_id};try{await this.createMessage(t)}catch(i){return void(e.sendSuss=!1)}finally{e.sendLoading=!1}if(e.sendSuss=!0,this.relateIssueLoading)return;this.relateIssueLoading=!0,await ee(1e3),this.getRelateIssueList(e.content)}if(e.contentType==b.vx.image){let t,s=le({blob:e.file.blob,filename:e.file.filename,type:e.file.type});console.log("==========",e.file,s);try{t=await ae({session_id:this.chatInfo.session_id,fileData:s})}catch(i){return e.sendSuss=!1,void(e.sendLoading=!1)}const n={message:t.download_url,type:b.vx.image,client_message_id:e.client_message_id};try{await this.createMessage(n)}catch(i){return void(e.sendSuss=!1)}finally{e.sendLoading=!1}e.sendSuss=!0}if(e.contentType==b.vx.ride){const t={message:e.selfId,type:b.vx.ride,client_message_id:e.client_message_id};try{await this.createMessage(t)}catch(i){return void(e.sendSuss=!1)}finally{e.sendLoading=!1}e.sendSuss=!0}},async switchStaff(){console.log("switchStaff invoke");let e=!1;try{const t=await this.msqueueJoin();if(console.log("switchStaff msqueueJoin resp=",t),t.state==b.yP.success)this.chatList.push({role:b.Sc.defaultTip,customId:te(),content:"- 客服接入成功，很高兴为您服务！-"}),this.chatList.push({role:b.Sc.staff,contentType:b.vx.text,content:{text:`您好，客服${t.staff_info.nickname}为您服务，请问您有什么需要咨询的问题吗？`},customId:te(),sendSuss:!0,sendLoading:!1,showMoreBtn:!1,moreId:te(),kfId:t.staff_info.user_id,kfname:t.staff_info.nickname,kfAvatar:t.staff_info.avatar_url}),e=!0,this.chatInfo.session_id=t.session_id,this.watchChatActive();else if(t.state==b.yP.inqueue){if(this.waitInfo.in_queue_count===t.in_queue_count)return;this.chatList.push({role:b.Sc.defaultTip,customId:te(),content:"转接客服失败，当前无空闲人员接待，已为您进入排队队列"}),this.chatList.push({role:b.Sc.roundTip,customId:te(),content:`在当前排队${t.in_queue_count}人，请稍后…`})}else t.state==b.yP.fail&&(this.chatList.push({role:b.Sc.leaveMsgBtn,customId:te(),content:"转接客服失败，暂时无法为您提供服务，请留言我们会尽快与您取得联系！"}),e=!0);if(this.goEnd(null,100),this.waitInfo=t,e)return;this.waitSwtichStaff(!0)}catch(t){return void(t.message==b.L_?(this.chatList.push({role:b.Sc.defaultTip,customId:te(),content:"- 网络异常 请稍后重试 -"}),this.goEnd(null,100)):t.message!=b.Eh&&this.$toast({message:t.message}))}},async getQueueStatus(){const e={session_id:this.chatInfo.session_id};let t;try{t=await Y(e)}catch(s){throw s.status!=b.Eh&&s.status!=b.L_?new Error(s.msg):new Error(s.status)}return t},handleClickIssues(e){this.handleSendText(null,e.content)},async handleChangeFile(e){console.log("选择图片=>",e,e.target.files);const t=e.target.files;if(!t.length)return;if(t.length>9)return void this.$toast("最多可选择9张");let s=!0;for(let n=0;n<t.length;n++){const e=t[n];if(!/\/(jpg|jpeg|png|gif)$/.test(e.type)){this.$toast("请上传图片格式"),s=!1;break}}if(s)for(let n=0;n<t.length;n++){const e=t[n];let s=URL.createObjectURL(e);const a={role:b.Sc.user,contentType:b.vx.image,content:{image:s},sendLoading:!0,sendSuss:!0,customId:te(),client_message_id:te(),file:{blob:ce(e),url:s,filename:e.name,type:e.type}};let o;this.chatList.push(a),this.goEnd();try{o=await ae({session_id:this.chatInfo.session_id,fileData:e})}catch(i){return a.sendSuss=!1,void(a.sendLoading=!1)}const r={message:o.download_url,type:b.vx.image,client_message_id:a.client_message_id};try{await this.createMessage(r)}catch(i){return void(a.sendSuss=!1)}finally{a.sendLoading=!1}a.sendSuss=!0}},async handleSendRide(e){console.log("发送乘车记录=>",e);const t={role:b.Sc.user,customId:te(),id:te(),contentType:b.vx.ride,content:{ride_record:e},sendLoading:!0,sendSuss:!0,client_message_id:te()};this.chatList.push(t),this.goEnd(),this.handleRideRecordHide();const s={message:e.selfId,type:b.vx.ride,client_message_id:t.client_message_id};try{await this.createMessage(s)}catch(i){return void(t.sendSuss=!1)}finally{t.sendLoading=!1}t.sendSuss=!0},async handleChatClose(e=!1,t){if(console.log("挂断聊天",this.waitInfo.session_id,t),!this.waitInfo.session_id)return;if(this.waitInfo.session_id!=t)return;const s={session_id:t};console.log("挂断聊天",s);try{await $(s)}catch(i){return void(i.status==b.L_?(this.chatList.push({role:b.Sc.defaultTip,customId:te(),content:"- 网络异常 请稍后重试 -"}),this.goEnd(null,100)):i.status!=b.Eh&&this.$toast({message:i.msg}))}clearInterval(this.messageQuitTimer),this.messageQuitTimer=null,this.messageQuitTime=0,this.messageQuitTipEnd=!1,!0!==e&&this.chatList.push({role:b.Sc.defaultTip,customId:te(),content:"- 本次服务已完成，请为本次服务做出评价! -"}),this.chatList.push({role:b.Sc.evaluate,customId:te(),content:0,session_id:this.waitInfo.session_id}),this.initMessageInfo(),this.waitList.push(this.waitInfo),this.waitInfo={},this.goEnd(null,100)},async handleChangeRate(e,t){console.log("评分=>",e,t);const s={session_id:t.session_id,star_count:e};try{await Z(s)}catch(i){return i.status==b.L_?(this.chatList.push({role:b.Sc.defaultTip,customId:te(),content:"- 网络异常 请稍后重试 -"}),this.goEnd(null,100)):i.status!=b.Eh&&this.$toast({message:i.msg}),void(t.content=0)}this.chatList.push({role:b.Sc.defaultTip,customId:te(),content:"- 感谢您的评价，我们会继续努力 -"}),this.goEnd(null,100)},async handldeSubmitLeave(){if(!this.leaveInfo.contact_info)return void this.$toast({message:"请输入联系方式"});if(!J(this.leaveInfo.contact_info))return void this.$toast({message:"手机号码格式不正确"});if(!this.leaveInfo.issue_desc)return void this.$toast({message:"请输入问题"});const e={session_id:this.chatInfo.session_id,contact_info:this.leaveInfo.contact_info,issue_desc:this.$xss(this.leaveInfo.issue_desc)};try{await U(e)}catch(t){return void(t.status!=b.Eh&&this.$toast({message:t.msg}))}this.leaveMessageVisible=!1,this.leaveMessageSuccVisible=!0,await ee(300),this.leaveInfo.contact_info="",this.leaveInfo.issue_desc=""},async onLoad(){},async handleLoadHistoryList(){const e=Q(this.chatList).find((e=>e.selfId));if(!e)return this.chatFinished=!0,this.chatRefreshing=!1,void this.chatList.unshift({role:b.Sc.marginTip,customId:te(),content:"暂无更多历史记录~"});let t=await this.getMessage({mode:b.XI.prev,start_message_id:e.message_id});if(t=this.filterMessage(t),!t.length)return this.chatFinished=!0,this.chatRefreshing=!1,void this.chatList.unshift({role:b.Sc.marginTip,customId:te(),content:"暂无更多历史记录~"});const s=document.getElementsByClassName("van-loading van-loading--circular")[0].offsetHeight,i=document.getElementsByClassName("chat-container")[0];this.chatRefreshing=!1,this.chatList.unshift(...t),this.initMoreBtn(),this.addChatTime(this.chatList,!0),this.$nextTick((()=>{i.scrollTo(0,document.getElementById(`${this.firstMsgId}`).offsetTop-s),console.log("=============",i.scrollTop,document.getElementById(`${this.firstMsgId}`).offsetTop,s),this.setFirstMsgId()}))},addChatTime(e,t){let s;if(e.length)if(t){let t=JSON.parse(JSON.stringify(e)).findIndex((e=>e.tips));for(let i=t;i>=0;i--){const n=e[i];if(i===t)s=n.createUnix;else if(n.createUnix&&n.createUnix+300<=s){let t;t=W(n.createUnix,"YYYY-MM-DD")==W(s,"YYYY-MM-DD")?W(n.createUnix,"HH:mm"):W(n.createUnix,"YYYY-MM-DD HH:mm"),e.splice(i,0,{createUnix:n.createUnix,tips:W(n.createUnix),role:b.Sc.defaultTip,content:t}),s=n.createUnix}}}else{let t=JSON.parse(JSON.stringify(e)).reverse().findIndex((e=>e.tips));t=t<0?0:e.length-1-t;for(let i=t;i<e.length;i++){const n=e[i];if(i===t)0===t&&e[i].role!=b.Sc.defaultTip&&e.splice(i,0,{createUnix:n.createUnix,tips:W(n.createUnix),role:b.Sc.defaultTip,customId:te(),content:W(n.createUnix,"YYYY-MM-DD HH:mm")}),s=n.createUnix;else if(n.createUnix>=s+300){let t;t=W(n.createUnix,"YYYY-MM-DD")==W(s,"YYYY-MM-DD")?W(n.createUnix,"HH:mm"):W(n.createUnix,"YYYY-MM-DD HH:mm"),e.splice(i,0,{createUnix:n.createUnix,tips:W(n.createUnix),role:b.Sc.defaultTip,customId:te(),content:t}),s=n.createUnix}}}},async handleRideSlideChange(){const e=this.rideTabList.tabList[this.rideTabList.tabIndex];console.log("结果=>",e)},async rideOnRefresh(e){let t;console.log("rideOnRefresh=>",e),t=this.payBusiness==b.ru.metroApp?this.rideTabList.tabList.find((t=>t.value==e.value)):this.payBusinessOthersList,t.page=1;try{await this.initRideList({page:t.page,size:t.size,pay_channel:t.value||"",refresh:!0})}catch(s){return console.log("结果=>","111"),s.message!=b.Eh&&this.$toast({message:s.msg}),void(this.payBusiness==b.ru.metroApp?(t.refreshing=!1,t.finished=!0):(this.payBusinessOthersList.refreshing=!1,this.payBusinessOthersList.finished=!0))}this.payBusiness==b.ru.metroApp?(t.refreshing=!1,t.finished=!1):(this.payBusinessOthersList.refreshing=!1,this.payBusinessOthersList.finished=!1)},async handleMessageScorll(){},async handleSwitchKf(){if(this.waitInfo.state==b.yP.inqueue||this.waitInfo.state==b.yP.success)return;this.chatList.push({role:b.Sc.roundTip,customId:te(),content:"正在为您转接人工客服，请稍后…"}),this.goEnd(null,100);let e=!1;try{const t=await this.msqueueJoin();if(console.log("==========getQueueStatus",t),t.state==b.yP.success||0==t.in_queue_count)this.chatList.push({role:b.Sc.hangUpCard,content:"",customId:te(),kfId:t.staff_info.user_id,kfname:t.staff_info.nickname,session_id:t.session_id}),this.chatList.push({role:b.Sc.staff,contentType:b.vx.text,content:{text:`您好，客服${t.staff_info.nickname}为您服务，请问您有什么需要咨询的问题吗？`},customId:te(),sendSuss:!0,sendLoading:!1,showMoreBtn:!1,moreId:te(),kfId:t.staff_info.user_id,kfname:t.staff_info.nickname,kfAvatar:t.staff_info.avatar_url}),e=!0,this.chatInfo.session_id=t.session_id,this.watchChatActive();else if(t.state==b.yP.inqueue){if(this.waitInfo.in_queue_count===t.in_queue_count)return;this.chatList.push({role:b.Sc.roundTip,customId:te(),content:`在当前排队${t.in_queue_count}人，请稍后…`})}else t.state==b.yP.fail&&(this.chatList.push({role:b.Sc.leaveMsgBtn,customId:te(),content:"很抱歉，暂时无法为您提供服务，请留言我们会尽快与您取得联系！"}),e=!0);this.goEnd(null,100),this.waitInfo=t}catch(t){return void(t.message==b.L_?(this.chatList.push({role:b.Sc.defaultTip,customId:te(),content:"- 网络异常 请稍后重试 -"}),this.goEnd(null,100)):t.message!=b.Eh&&this.$toast({message:t.message}))}e||this.waitSwtichStaff()},async handleSendText(e,t){let s;if(t)s=t;else if(s=document.querySelector(".chat-footer-input").innerHTML,!s)return;console.log("结果content=>",s,this.$xss(s));const i={role:b.Sc.user,contentType:b.vx.text,content:{text:this.$xss(s)},sendLoading:!0,sendSuss:!0,customId:te(),client_message_id:te()};this.chatList.push(i),t||(document.querySelector(".chat-footer-input").innerHTML="",this.chatInputContent=""),this.goEnd(null,100);const n={message:s,type:b.vx.text,client_message_id:i.client_message_id};let a;try{a=await this.createMessage(n)}catch(o){return void(i.sendSuss=!1)}finally{i.sendLoading=!1}i.sendSuss=!0,a.is_hit_msk&&(this.chatList.push({role:b.Sc.switchKfBtn,customId:te(),content:""}),this.goEnd(null,100))},async msqueueJoin(){console.log("msqueueJoin invoke");const e={session_id:this.chatInfo.session_id};let t;try{t=await H(e)}catch(s){throw s.status!=b.Eh&&s.status!=b.L_?new Error(s.msg):new Error(s.status)}return this.chatInfo.session_id=t.session_id,t},async messageQuit(){console.log("messageQuit invoke");const e={session_id:this.chatInfo.session_id};try{await A(e)}catch(t){return}},async sessionHeartbeat(){const e={session_id:this.chatInfo.session_id};try{await R(e)}catch(t){return}},async createMessage(e){const t={session_id:this.chatInfo.session_id,message:e.message,type:e.type,client_message_id:e.client_message_id};let s;console.log("createMessage",t);try{s=await O(t)}catch(i){throw new Error(i.msg)}return this.waitInfo.session_id&&this.watchChatActive(),s},async getMessage(e){console.log("getMessage invoke",e);const t={session_id:this.chatInfo.session_id,mode:e.mode,start_message_id:e.start_message_id,size:e.size||b.NR};let s;console.log("getMessage req=",t);try{s=await N(t)}catch(i){return[]}return console.log("getMessage success resp=",s),s.message_list=s.message_list||[],s.message_list=s.message_list.map((e=>({...e,selfId:e.message_id}))),s.message_list},handleIssuesMoreShow(e){e.showMoreBtn=!1;const t=document.getElementById(e.moreId);t.classList.add("act")},handlePicShow(e){this.picSrc=e,this.picVisible=!0},handlePicHide(){this.picVisible=!1,this.picSrc=""},handleLeaveMessageSuccShow(){this.leaveMessageSuccVisible=!0},handleLeaveMessageSuccHide(){this.leaveMessageSuccVisible=!1},async handleRideRecordShow(){this.rideRecordVisible=!0},handleRideRecordHide(){this.rideRecordVisible=!1},setFirstMsgId(){this.chatList=this.chatList.map((e=>(e.id=te(),e))),this.firstMsgId=this.chatList[0].id},goEnd(e,t=200){this.$nextTick((()=>{setTimeout((()=>{if(this.$refs.common_chat_main){try{document.getElementsByClassName("chat-messages-item")[document.getElementsByClassName("chat-messages-item").length-1].scrollIntoView({behavior:"auto",block:"end",inline:"nearest"})}catch(t){}e&&e()}}),t)}))},handleTouchPage(){},handleInput(e){this.chatInputContent=e.target.innerHTML},handleInputBlur(){let e=navigator.userAgent;e.indexOf("iPhone")>-1&&window.scrollTo(0,0),this.chatInputFocus=!1},handleInputFocus(){this.$nextTick((()=>{this.chatInputFocus=!0}))},handleLeaveMessageShow(){this.leaveMessageVisible=!0},async handleLeaveMessageHide(){this.leaveMessageVisible=!1,await ee(300),this.leaveInfo.contact_info="",this.leaveInfo.issue_desc=""}}},Ie=ve,ye=(0,c.Z)(Ie,me,ge,!1,null,null,null),we=ye.exports,Ce=function(){var e=this;e._self._c;return e._m(0)},be=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"error"},[t("div",{staticClass:"error-box"},[t("img",{attrs:{src:s(8288),alt:""}}),t("p",[e._v("页面地址不存在 请联系官方客服")])])])}],Le={name:"ErrorPage"},Se=Le,Te=(0,c.Z)(Se,Ce,be,!1,null,"21e140d0",null),Ee=Te.exports;const xe=f.ZP.prototype.push;f.ZP.prototype.push=function(e,t,s){return t||s?xe.call(this,e,t,s):xe.call(this,e).catch((e=>e))},i.ZP.use(f.ZP);const ke=[{path:"/",name:"home",meta:{keepAlive:!0},component:we},{path:"/login",name:"Login",meta:{keepAlive:!0},component:fe},{path:"/error",name:"Error",meta:{keepAlive:!1},component:Ee},{path:"/leavemsg-list",name:"LeaveMsgList",meta:{keepAlive:!1},component:()=>s.e(100).then(s.bind(s,1118))},{path:"/leavemsg-detail",name:"LeaveMsgDetail",meta:{keepAlive:!1},component:()=>s.e(100).then(s.bind(s,7350))}],Me=new f.ZP({routes:ke});var Pe=Me,Be=(s(5102),s(5110),s(7944),s(5650)),Ae=(s(4346),s(888)),Re=(s(7580),s(7937)),Oe=(s(6791),s(4269)),Ne=(s(3429),s(7722)),Ue=(s(4889),s(5705)),Ye=(s(5825),s(9858)),$e=(s(109),s(6142)),Ze=(s(8778),s(5910)),He=(s(9571),s(4958)),De=(s(3772),s(2778)),Fe=(s(2443),s(9864)),je=(s(2699),s(8799)),qe=(s(4439),s(3462)),ze=(s(5657),s(9538)),Ve=(s(4735),s(6471)),Je=(s(3089),s(4398)),Qe=(s(8146),s(8848)),We=(s(5816),s(9387)),Ke=(s(2679),s(9054)),Xe=(s(836),s(6811)),Ge=(s(446),s(7847)),et=(s(2763),s(5094)),tt=(s(6735),s(4319)),st=(s(3412),s(7740));i.ZP.use(st.Z),i.ZP.use(tt.Z),i.ZP.use(et.Z),i.ZP.use(Ge.Z),i.ZP.use(Xe.Z),i.ZP.use(Ke.Z),i.ZP.use(We.Z),i.ZP.use(Qe.Z),i.ZP.use(Je.Z),i.ZP.use(Ve.Z),i.ZP.use(ze.Z),i.ZP.use(qe.Z),i.ZP.use(je.Z),i.ZP.use(Fe.Z),i.ZP.use(De.Z),i.ZP.use(He.Z),i.ZP.use(Ze.Z),i.ZP.use($e.Z),i.ZP.use(Ye.Z),i.ZP.use(Ue.Z),i.ZP.use(Ne.Z),i.ZP.use(Oe.Z),i.ZP.use(Re.Z),i.ZP.use(Ae.Z),i.ZP.use(Be.Z),i.ZP.config.productionTip=!1,i.ZP.use(h()),Object.defineProperty(i.ZP.prototype,"$xss",{value:h()}),new i.ZP({router:Pe,render:e=>e(u)}).$mount("#app")},9624:function(e,t,s){"use strict";s.d(t,{Eh:function(){return a},JK:function(){return g},K0:function(){return h},LA:function(){return r},L_:function(){return o},NR:function(){return n},Ry:function(){return w},Sc:function(){return C},Sy:function(){return T},Ws:function(){return f},XI:function(){return y},bj:function(){return L},eC:function(){return m},gj:function(){return p},i2:function(){return l},iu:function(){return u},p6:function(){return I},ru:function(){return d},s$:function(){return x},vx:function(){return b},yP:function(){return S},z6:function(){return c}});const i=function(e,t){const s={};return e.forEach((e=>{const i=e[t];s[i]=e})),s},n=50,a=3,o=6,r="kf_a_tk",c="kt_r_tk",l="在线客服",u="请输入您想咨询的问题",d={metroApp:"METRO",ticketing:"TVM",wxCode:"MP_WECHAT",cloudFlashPay:"MP_UNION",alipayCode:"MP_ALIPAY",mpCmb:"MP_CMB"},h=[{value:d.metroApp,label:"Metro大都会APP"},{value:d.ticketing,label:"自助购票机"},{value:d.wxCode,label:"微信乘车码小程序"},{value:d.cloudFlashPay,label:"云闪付小程序"},{value:d.alipayCode,label:"支付宝乘车码"},{value:d.mpCmb,label:"招行掌上银行"}],f=i(h,"value"),m={zfb:"ZFB",wx:"WX",union:"UNION",digital:"DIGITAL",wxQrocode:"WXQRCODE"},g=[{value:m.zfb,label:"支付宝"},{value:m.wx,label:"微信"},{value:m.union,label:"银联"},{value:m.digital,label:"数币"}],p=i(g,"value"),_={paying:"PAYING",success:"PAY_SUCCESS",failed:"PAY_EXCEPTION",refunded:"REFUNDED",refundedException:"REFUNDED_EXCEPTION"},v=[{value:_.paying,label:"支付中",color:""},{value:_.success,label:"支付成功",color:"#666666"},{value:_.failed,label:"支付失败",color:"#F5222D"},{value:_.refunded,label:"退款成功",color:"#52C41A"},{value:_.refundedException,label:"退款失败",color:"#FAAD14"}],I=i(v,"value"),y={next:1,prev:2},w={attachment:"ATTACHMENT",image:"IMAGE"},C={hotIssues:"hotIssues",roundTip:"roundTip",defaultTip:"defaultTip",marginTip:"marginTip",switchKfBtn:"switchKfBtn",hangUpCard:"hangUpCard",evaluate:"evaluate",leaveMsg:"leaveMsg",leaveMsgBtn:"leaveMsgBtn",relatedIssues:"relatedIssues",user:"user",staff:"staff",robot:"robot"},b={text:"TEXT",image:"IMAGE",ride:"RIDE_RECORD",auto:"auto"},L={staff:"STAFF",user:"CUSTOM"},S={init:"ROBOT",inqueue:"INQUEUE",success:"SUCCESS",transfer:"TRANSFER",fail:"FAIL",evaluate:"EVALUATE"},T={dealed:"1",completion:"2"},E=[{value:T.dealed,label:"处理中",color:"#1890ff",tips:"您反馈的问题正在处理中，我们将尽快为您解决，如有疑问可联系在线客服"},{value:T.completion,label:"已办结",color:"#ff9400",tips:"您反馈的问题已办结，感谢您的反馈！"}],x=i(E,"value")},5102:function(){(function(e,t){var s=t.documentElement,i=e.devicePixelRatio||1;function n(){t.body?t.body.style.fontSize=12*i+"px":t.addEventListener("DOMContentLoaded",n)}function a(){var e=s.clientWidth/10;s.style.fontSize=e+"px"}if(n(),a(),e.addEventListener("resize",a),e.addEventListener("pageshow",(function(e){e.persisted&&a()})),i>=2){var o=t.createElement("body"),r=t.createElement("div");r.style.border=".5px solid transparent",o.appendChild(r),s.appendChild(o),1===r.offsetHeight&&s.classList.add("hairlines"),s.removeChild(o)}})(window,document)},4156:function(e,t,s){"use strict";e.exports=s.p+"img/3.3ef72f8f.svg"},3822:function(e,t,s){"use strict";e.exports=s.p+"img/4.05052e57.svg"},8288:function(e,t,s){"use strict";e.exports=s.p+"img/404.d9d458e9.png"},8773:function(e,t,s){"use strict";e.exports=s.p+"img/5.a726e987.png"},5819:function(){}},t={};function s(i){var n=t[i];if(void 0!==n)return n.exports;var a=t[i]={exports:{}};return e[i].call(a.exports,a,a.exports,s),a.exports}s.m=e,function(){var e=[];s.O=function(t,i,n,a){if(!i){var o=1/0;for(u=0;u<e.length;u++){i=e[u][0],n=e[u][1],a=e[u][2];for(var r=!0,c=0;c<i.length;c++)(!1&a||o>=a)&&Object.keys(s.O).every((function(e){return s.O[e](i[c])}))?i.splice(c--,1):(r=!1,a<o&&(o=a));if(r){e.splice(u--,1);var l=n();void 0!==l&&(t=l)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[i,n,a]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){s.f={},s.e=function(e){return Promise.all(Object.keys(s.f).reduce((function(t,i){return s.f[i](e,t),t}),[]))}}(),function(){s.u=function(e){return"js/group-foo.4a26e43b.js"}}(),function(){s.miniCssF=function(e){return"css/group-foo.fae3af17.css"}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="h5:";s.l=function(i,n,a,o){if(e[i])e[i].push(n);else{var r,c;if(void 0!==a)for(var l=document.getElementsByTagName("script"),u=0;u<l.length;u++){var d=l[u];if(d.getAttribute("src")==i||d.getAttribute("data-webpack")==t+a){r=d;break}}r||(c=!0,r=document.createElement("script"),r.charset="utf-8",r.timeout=120,s.nc&&r.setAttribute("nonce",s.nc),r.setAttribute("data-webpack",t+a),r.src=i),e[i]=[n];var h=function(t,s){r.onerror=r.onload=null,clearTimeout(f);var n=e[i];if(delete e[i],r.parentNode&&r.parentNode.removeChild(r),n&&n.forEach((function(e){return e(s)})),t)return t(s)},f=setTimeout(h.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=h.bind(null,r.onerror),r.onload=h.bind(null,r.onload),c&&document.head.appendChild(r)}}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){s.p="./"}(),function(){if("undefined"!==typeof document){var e=function(e,t,s,i,n){var a=document.createElement("link");a.rel="stylesheet",a.type="text/css";var o=function(s){if(a.onerror=a.onload=null,"load"===s.type)i();else{var o=s&&("load"===s.type?"missing":s.type),r=s&&s.target&&s.target.href||t,c=new Error("Loading CSS chunk "+e+" failed.\n("+r+")");c.code="CSS_CHUNK_LOAD_FAILED",c.type=o,c.request=r,a.parentNode&&a.parentNode.removeChild(a),n(c)}};return a.onerror=a.onload=o,a.href=t,s?s.parentNode.insertBefore(a,s.nextSibling):document.head.appendChild(a),a},t=function(e,t){for(var s=document.getElementsByTagName("link"),i=0;i<s.length;i++){var n=s[i],a=n.getAttribute("data-href")||n.getAttribute("href");if("stylesheet"===n.rel&&(a===e||a===t))return n}var o=document.getElementsByTagName("style");for(i=0;i<o.length;i++){n=o[i],a=n.getAttribute("data-href");if(a===e||a===t)return n}},i=function(i){return new Promise((function(n,a){var o=s.miniCssF(i),r=s.p+o;if(t(o,r))return n();e(i,r,null,n,a)}))},n={143:0};s.f.miniCss=function(e,t){var s={100:1};n[e]?t.push(n[e]):0!==n[e]&&s[e]&&t.push(n[e]=i(e).then((function(){n[e]=0}),(function(t){throw delete n[e],t})))}}}(),function(){var e={143:0};s.f.j=function(t,i){var n=s.o(e,t)?e[t]:void 0;if(0!==n)if(n)i.push(n[2]);else{var a=new Promise((function(s,i){n=e[t]=[s,i]}));i.push(n[2]=a);var o=s.p+s.u(t),r=new Error,c=function(i){if(s.o(e,t)&&(n=e[t],0!==n&&(e[t]=void 0),n)){var a=i&&("load"===i.type?"missing":i.type),o=i&&i.target&&i.target.src;r.message="Loading chunk "+t+" failed.\n("+a+": "+o+")",r.name="ChunkLoadError",r.type=a,r.request=o,n[1](r)}};s.l(o,c,"chunk-"+t,t)}},s.O.j=function(t){return 0===e[t]};var t=function(t,i){var n,a,o=i[0],r=i[1],c=i[2],l=0;if(o.some((function(t){return 0!==e[t]}))){for(n in r)s.o(r,n)&&(s.m[n]=r[n]);if(c)var u=c(s)}for(t&&t(i);l<o.length;l++)a=o[l],s.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return s.O(u)},i=self["webpackChunkh5"]=self["webpackChunkh5"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=s.O(void 0,[998],(function(){return s(7194)}));i=s.O(i)})();